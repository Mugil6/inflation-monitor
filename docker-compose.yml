version: '3.8'

services:
  airflow:
    # 1. LINK TO GITHUB BUILD
    # This tells Docker: "Don't build from my laptop. Pull the finished code from the cloud."
    image: mugil6/rbi-inflation-monitor:latest
    
    # 2. RESTART POLICY
    # If the DAG crashes, this forces it to try again.
    restart: always
    
    # 3. ENVIRONMENT VARIABLES (Crucial for DAG Success)
    # The DAG needs these to talk to Supabase. Without them, the DAG fails immediately.
    env_file:
      - .env
    environment:
      - AIRFLOW__CORE__LOAD_EXAMPLES=False
      - AIRFLOW__CORE__EXECUTOR=LocalExecutor
      # Pass secrets explicitly if .env has issues
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}
      
    # 4. VOLUMES (Optional but Recommended)
    # Even though code is in the image, this keeps logs persistent so you can debug failures.
    volumes:
      - ./logs:/opt/airflow/logs
      
    ports:
      - "8080:8080"