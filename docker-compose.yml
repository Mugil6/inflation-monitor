version: '3.8'

services:
  airflow:
    image: mugil6/rbi-inflation-monitor:latest
    restart: always
    env_file:
      - .env
    environment:
      # 1. FIX: Use SequentialExecutor (Compatible with SQLite)
      - AIRFLOW__CORE__EXECUTOR=SequentialExecutor
      - AIRFLOW__DATABASE__SQL_ALCHEMY_CONN=sqlite:////opt/airflow/airflow.db
      - AIRFLOW__CORE__LOAD_EXAMPLES=False
      
      # 2. PASS YOUR SECRETS
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}
      
    # 3. FIX: Run "standalone" to start Webserver + Scheduler + DB Init together
    command: standalone
      
    volumes:
      - ./logs:/opt/airflow/logs
    ports:
      - "8080:8080"